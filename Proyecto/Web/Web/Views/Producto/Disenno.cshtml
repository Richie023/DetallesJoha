@model Web.Entidades.Producto
@{
    ViewBag.Title = "Disenno";
    Layout = "~/Views/Shared/_LayoutExterno.cshtml";
}

<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/3.6.2/fabric.min.js">

</script>

<style>
    canvas {
        border: 4px solid #323232;
       block-size: contain;
        background-repeat: no-repeat;

    }

    #canvas {
    

        background-color: transparent;
        background-size:contain;
    }

    input {
        margin: 5px 0;
    }
    




</style>



<h2>Diseño personalizado</h2>

<div class="section">
    <div class="container">
        <div class="row">
            <!-- Product main img -->
            <div class="col-md-5 col-md-push-2">
                <div id="product-main-img">
                    <div class="product-preview">
                        <canvas id="canvas" class="container-">
                        </canvas>
                    </div>
                </div>
            </div>

            <!-- Product thumb imgs -->
            <div class="col-md-2 col-md-pull-5">
                <div id="product-imgs">
                    <div class="product-preview">
                        <img src="@Model.RutaImagen" alt="@Model.NombreProducto">
                    </div>
                </div>
            </div>

            <div class="col-md-5">
                <div class="product-details">
                    <h2 class="product-name">@Model.NombreProducto</h2>

                    <div class="container-input">
                        <input type="file" name="file-5" id="input" class="inputfile inputfile-5" data-multiple-caption="{count} archivos seleccionados" multiple />
                        <label for="input">
                            <figure>
                                <svg xmlns="http://www.w3.org/2000/svg" class="iborrainputfile" width="20" height="17" viewBox="0 0 20 17"><path d="M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"></path></svg>
                            </figure>
                            <span class="iborrainputfile">Seleccionar archivo</span>
                        </label>
                    </div>

                </div>
            </div>

                <div>

                    <label for="text-input">Texto Personalizado:</label>
                    <input type="text" id="text-input" />
                    <button onclick="addText()" class="primary-btn">Agregar Texto</button>
                </div>
                <button class="fa fa-trash fa-3x" title="Limpiar" onclick="clearAll()"> 
                </button>



                <div>

                    <a id="lnkDownload" href="">Guardar Imagen</a>
                </div>






                <p><img id="my-image" type="input" src="@ViewBag.urlImagen" width="50" height="50"></p>

            </div>
        </div>
</div>
           


      
            <script src="https://cdn.jsdelivr.net/npm/fabric@latest/dist/index.min.js"></script>

            <script src="~/Estilos/js/disenno.js"></script>

            <script>
                function addText() {
                    const text = document.getElementById('text-input').value;
                    const textObject = new fabric.IText(text, { left: 50, top: 50, fontSize: 30 });
                    canvas.add(textObject);
                }
            </script>

            <script>
    function clearAll() {
        if (window.confirm('¿Estás seguro de que deseas limpiar el lienzo? Esta acción no se puede deshacer.')) {
           canvas.remove(...canvas.getObjects());
           canvas.add(image);
        }
    }
              </script>
            <script>
                input.onchange = (evnt) => {
                    const file = evnt.target.files[0];
                   const url = URL.createObjectURL(file);
                    const imgNode = new Image();
                    imgNode.src = url;
                    imgNode.onload = () => {
                        const img = new fabric.Image(imgNode, {
                            top: 0,
                             });
                        img.scaleToWidth(100, false);
                        canvas.add(img); // esta es la mágia
                    };
                };
            </script>
            <script>
                function handleImage(e) {
                    var objects = canvas.getObjects();
                    for (var i in objects) {
                        objects[i].remove();
                    }
                    var reader = new FileReader();
                    reader.onload = function (event) {
                        var img = new Image();
                        img.onload = function () {
                            var imgInstance = new fabric.Image(img, {
                                selectable: 1
                            })
                            canvas.add(imgInstance);
                            canvas.deactivateAll().renderAll();
                        }
                        img.src = event.target.result;
                    }
                    reader.readAsDataURL(e.target.files[0]);
                }
            </script>
            <script>
                var imageSaver = document.getElementById('lnkDownload');
                imageSaver.addEventListener('click', saveImage, false);
                function saveImage(e) {
                    this.href = canvas.toDataURL({
                        SVGUseElement,
                        format: 'png',
                        quality: 0.8
                    });
                    this.download = 'canvas.png'
                }
            </script>
            <script>
                var Imagen = document.getElementById('my-image');
                var image = new fabric.Image(Imagen, {
                    x: 0,
                    y: 0,
                    selectable: false,                
                });
                image.scaleToWidth(canvas.width, false);
                canvas.add(image);


            </script>
